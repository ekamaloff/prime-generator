package prime.generator;

import org.junit.Assert;
import org.junit.Test;

import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.stream.IntStream;

/**
 * Base class for prime generator tests.
 *
 * The purpose of these tests is:
 *   - ensure the generator produces _all_ primes in given range
 *   - ensure all values produced by generator are valid prime numbers (no false positives)
 *
 * Therefore the tests verify the basic validity of the algorithm implementation.
 *
 * The tests include checking the first 1000L primes and primes generated
 * in range [90L,000L..100L,000L] against known primes in these ranges.
 *
 * We also test each 10Lth prime in a larger range using a trial division method.
 *
 */
public abstract class PrimeGeneratorTestBase {

    // First 1000L, primes from a trusted source for independent verification
    private static final List<Long> SMALL_PRIMES = Arrays.asList(
            2L,      3L,      5L,      7L,     11L,     13L,     17L,     19L,     23L,     29L,
            31L,     37L,     41L,     43L,     47L,     53L,     59L,     61L,     67L,     71L,
            73L,     79L,     83L,     89L,     97L,    101L,    103L,    107L,    109L,    113L,
            127L,    131L,    137L,    139L,    149L,    151L,    157L,    163L,    167L,    173L,
            179L,    181L,    191L,    193L,    197L,    199L,    211L,    223L,    227L,    229L,
            233L,    239L,    241L,    251L,    257L,    263L,    269L,    271L,    277L,    281L,
            283L,    293L,    307L,    311L,    313L,    317L,    331L,    337L,    347L,    349L,
            353L,    359L,    367L,    373L,    379L,    383L,    389L,    397L,    401L,    409L,
            419L,    421L,    431L,    433L,    439L,    443L,    449L,    457L,    461L,    463L,
            467L,    479L,    487L,    491L,    499L,    503L,    509L,    521L,    523L,    541L,
            547L,    557L,    563L,    569L,    571L,    577L,    587L,    593L,    599L,    601L,
            607L,    613L,    617L,    619L,    631L,    641L,    643L,    647L,    653L,    659L,
            661L,    673L,    677L,    683L,    691L,    701L,    709L,    719L,    727L,    733L,
            739L,    743L,    751L,    757L,    761L,    769L,    773L,    787L,    797L,    809L,
            811L,    821L,    823L,    827L,    829L,    839L,    853L,    857L,    859L,    863L,
            877L,    881L,    883L,    887L,    907L,    911L,    919L,    929L,    937L,    941L,
            947L,    953L,    967L,    971L,    977L,    983L,    991L,    997L,   1009L,   1013L,
            1019L,   1021L,   1031L,   1033L,   1039L,   1049L,   1051L,   1061L,   1063L,   1069L,
            1087L,   1091L,   1093L,   1097L,   1103L,   1109L,   1117L,   1123L,   1129L,   1151L,
            1153L,   1163L,   1171L,   1181L,   1187L,   1193L,   1201L,   1213L,   1217L,   1223L,
            1229L,   1231L,   1237L,   1249L,   1259L,   1277L,   1279L,   1283L,   1289L,   1291L,
            1297L,   1301L,   1303L,   1307L,   1319L,   1321L,   1327L,   1361L,   1367L,   1373L,
            1381L,   1399L,   1409L,   1423L,   1427L,   1429L,   1433L,   1439L,   1447L,   1451L,
            1453L,   1459L,   1471L,   1481L,   1483L,   1487L,   1489L,   1493L,   1499L,   1511L,
            1523L,   1531L,   1543L,   1549L,   1553L,   1559L,   1567L,   1571L,   1579L,   1583L,
            1597L,   1601L,   1607L,   1609L,   1613L,   1619L,   1621L,   1627L,   1637L,   1657L,
            1663L,   1667L,   1669L,   1693L,   1697L,   1699L,   1709L,   1721L,   1723L,   1733L,
            1741L,   1747L,   1753L,   1759L,   1777L,   1783L,   1787L,   1789L,   1801L,   1811L,
            1823L,   1831L,   1847L,   1861L,   1867L,   1871L,   1873L,   1877L,   1879L,   1889L,
            1901L,   1907L,   1913L,   1931L,   1933L,   1949L,   1951L,   1973L,   1979L,   1987L,
            1993L,   1997L,   1999L,   2003L,   2011L,   2017L,   2027L,   2029L,   2039L,   2053L,
            2063L,   2069L,   2081L,   2083L,   2087L,   2089L,   2099L,   2111L,   2113L,   2129L,
            2131L,   2137L,   2141L,   2143L,   2153L,   2161L,   2179L,   2203L,   2207L,   2213L,
            2221L,   2237L,   2239L,   2243L,   2251L,   2267L,   2269L,   2273L,   2281L,   2287L,
            2293L,   2297L,   2309L,   2311L,   2333L,   2339L,   2341L,   2347L,   2351L,   2357L,
            2371L,   2377L,   2381L,   2383L,   2389L,   2393L,   2399L,   2411L,   2417L,   2423L,
            2437L,   2441L,   2447L,   2459L,   2467L,   2473L,   2477L,   2503L,   2521L,   2531L,
            2539L,   2543L,   2549L,   2551L,   2557L,   2579L,   2591L,   2593L,   2609L,   2617L,
            2621L,   2633L,   2647L,   2657L,   2659L,   2663L,   2671L,   2677L,   2683L,   2687L,
            2689L,   2693L,   2699L,   2707L,   2711L,   2713L,   2719L,   2729L,   2731L,   2741L,
            2749L,   2753L,   2767L,   2777L,   2789L,   2791L,   2797L,   2801L,   2803L,   2819L,
            2833L,   2837L,   2843L,   2851L,   2857L,   2861L,   2879L,   2887L,   2897L,   2903L,
            2909L,   2917L,   2927L,   2939L,   2953L,   2957L,   2963L,   2969L,   2971L,   2999L,
            3001L,   3011L,   3019L,   3023L,   3037L,   3041L,   3049L,   3061L,   3067L,   3079L,
            3083L,   3089L,   3109L,   3119L,   3121L,   3137L,   3163L,   3167L,   3169L,   3181L,
            3187L,   3191L,   3203L,   3209L,   3217L,   3221L,   3229L,   3251L,   3253L,   3257L,
            3259L,   3271L,   3299L,   3301L,   3307L,   3313L,   3319L,   3323L,   3329L,   3331L,
            3343L,   3347L,   3359L,   3361L,   3371L,   3373L,   3389L,   3391L,   3407L,   3413L,
            3433L,   3449L,   3457L,   3461L,   3463L,   3467L,   3469L,   3491L,   3499L,   3511L,
            3517L,   3527L,   3529L,   3533L,   3539L,   3541L,   3547L,   3557L,   3559L,   3571L,
            3581L,   3583L,   3593L,   3607L,   3613L,   3617L,   3623L,   3631L,   3637L,   3643L,
            3659L,   3671L,   3673L,   3677L,   3691L,   3697L,   3701L,   3709L,   3719L,   3727L,
            3733L,   3739L,   3761L,   3767L,   3769L,   3779L,   3793L,   3797L,   3803L,   3821L,
            3823L,   3833L,   3847L,   3851L,   3853L,   3863L,   3877L,   3881L,   3889L,   3907L,
            3911L,   3917L,   3919L,   3923L,   3929L,   3931L,   3943L,   3947L,   3967L,   3989L,
            4001L,   4003L,   4007L,   4013L,   4019L,   4021L,   4027L,   4049L,   4051L,   4057L,
            4073L,   4079L,   4091L,   4093L,   4099L,   4111L,   4127L,   4129L,   4133L,   4139L,
            4153L,   4157L,   4159L,   4177L,   4201L,   4211L,   4217L,   4219L,   4229L,   4231L,
            4241L,   4243L,   4253L,   4259L,   4261L,   4271L,   4273L,   4283L,   4289L,   4297L,
            4327L,   4337L,   4339L,   4349L,   4357L,   4363L,   4373L,   4391L,   4397L,   4409L,
            4421L,   4423L,   4441L,   4447L,   4451L,   4457L,   4463L,   4481L,   4483L,   4493L,
            4507L,   4513L,   4517L,   4519L,   4523L,   4547L,   4549L,   4561L,   4567L,   4583L,
            4591L,   4597L,   4603L,   4621L,   4637L,   4639L,   4643L,   4649L,   4651L,   4657L,
            4663L,   4673L,   4679L,   4691L,   4703L,   4721L,   4723L,   4729L,   4733L,   4751L,
            4759L,   4783L,   4787L,   4789L,   4793L,   4799L,   4801L,   4813L,   4817L,   4831L,
            4861L,   4871L,   4877L,   4889L,   4903L,   4909L,   4919L,   4931L,   4933L,   4937L,
            4943L,   4951L,   4957L,   4967L,   4969L,   4973L,   4987L,   4993L,   4999L,   5003L,
            5009L,   5011L,   5021L,   5023L,   5039L,   5051L,   5059L,   5077L,   5081L,   5087L,
            5099L,   5101L,   5107L,   5113L,   5119L,   5147L,   5153L,   5167L,   5171L,   5179L,
            5189L,   5197L,   5209L,   5227L,   5231L,   5233L,   5237L,   5261L,   5273L,   5279L,
            5281L,   5297L,   5303L,   5309L,   5323L,   5333L,   5347L,   5351L,   5381L,   5387L,
            5393L,   5399L,   5407L,   5413L,   5417L,   5419L,   5431L,   5437L,   5441L,   5443L,
            5449L,   5471L,   5477L,   5479L,   5483L,   5501L,   5503L,   5507L,   5519L,   5521L,
            5527L,   5531L,   5557L,   5563L,   5569L,   5573L,   5581L,   5591L,   5623L,   5639L,
            5641L,   5647L,   5651L,   5653L,   5657L,   5659L,   5669L,   5683L,   5689L,   5693L,
            5701L,   5711L,   5717L,   5737L,   5741L,   5743L,   5749L,   5779L,   5783L,   5791L,
            5801L,   5807L,   5813L,   5821L,   5827L,   5839L,   5843L,   5849L,   5851L,   5857L,
            5861L,   5867L,   5869L,   5879L,   5881L,   5897L,   5903L,   5923L,   5927L,   5939L,
            5953L,   5981L,   5987L,   6007L,   6011L,   6029L,   6037L,   6043L,   6047L,   6053L,
            6067L,   6073L,   6079L,   6089L,   6091L,   6101L,   6113L,   6121L,   6131L,   6133L,
            6143L,   6151L,   6163L,   6173L,   6197L,   6199L,   6203L,   6211L,   6217L,   6221L,
            6229L,   6247L,   6257L,   6263L,   6269L,   6271L,   6277L,   6287L,   6299L,   6301L,
            6311L,   6317L,   6323L,   6329L,   6337L,   6343L,   6353L,   6359L,   6361L,   6367L,
            6373L,   6379L,   6389L,   6397L,   6421L,   6427L,   6449L,   6451L,   6469L,   6473L,
            6481L,   6491L,   6521L,   6529L,   6547L,   6551L,   6553L,   6563L,   6569L,   6571L,
            6577L,   6581L,   6599L,   6607L,   6619L,   6637L,   6653L,   6659L,   6661L,   6673L,
            6679L,   6689L,   6691L,   6701L,   6703L,   6709L,   6719L,   6733L,   6737L,   6761L,
            6763L,   6779L,   6781L,   6791L,   6793L,   6803L,   6823L,   6827L,   6829L,   6833L,
            6841L,   6857L,   6863L,   6869L,   6871L,   6883L,   6899L,   6907L,   6911L,   6917L,
            6947L,   6949L,   6959L,   6961L,   6967L,   6971L,   6977L,   6983L,   6991L,   6997L,
            7001L,   7013L,   7019L,   7027L,   7039L,   7043L,   7057L,   7069L,   7079L,   7103L,
            7109L,   7121L,   7127L,   7129L,   7151L,   7159L,   7177L,   7187L,   7193L,   7207L,
            7211L,   7213L,   7219L,   7229L,   7237L,   7243L,   7247L,   7253L,   7283L,   7297L,
            7307L,   7309L,   7321L,   7331L,   7333L,   7349L,   7351L,   7369L,   7393L,   7411L,
            7417L,   7433L,   7451L,   7457L,   7459L,   7477L,   7481L,   7487L,   7489L,   7499L,
            7507L,   7517L,   7523L,   7529L,   7537L,   7541L,   7547L,   7549L,   7559L,   7561L,
            7573L,   7577L,   7583L,   7589L,   7591L,   7603L,   7607L,   7621L,   7639L,   7643L,
            7649L,   7669L,   7673L,   7681L,   7687L,   7691L,   7699L,   7703L,   7717L,   7723L,
            7727L,   7741L,   7753L,   7757L,   7759L,   7789L,   7793L,   7817L,   7823L,   7829L,
            7841L,   7853L,   7867L,   7873L,   7877L,   7879L,   7883L,   7901L,   7907L,   7919L
    );

    private static final long RANGE_START = 90_000L;
    private static final long RANGE_END = 100_000L;
    private static final List<Long> PRIMES_IN_RANGE = Arrays.asList(
            90001L,  90007L,  90011L,  90017L,  90019L,  90023L,  90031L,
            90053L,  90059L,  90067L,  90071L,  90073L,  90089L,  90107L,  90121L,  90127L,  90149L,
            90163L,  90173L,  90187L,  90191L,  90197L,  90199L,  90203L,  90217L,  90227L,  90239L,
            90247L,  90263L,  90271L,  90281L,  90289L,  90313L,  90353L,  90359L,  90371L,  90373L,
            90379L,  90397L,  90401L,  90403L,  90407L,  90437L,  90439L,  90469L,  90473L,  90481L,
            90499L,  90511L,  90523L,  90527L,  90529L,  90533L,  90547L,  90583L,  90599L,  90617L,
            90619L,  90631L,  90641L,  90647L,  90659L,  90677L,  90679L,  90697L,  90703L,  90709L,
            90731L,  90749L,  90787L,  90793L,  90803L,  90821L,  90823L,  90833L,  90841L,  90847L,
            90863L,  90887L,  90901L,  90907L,  90911L,  90917L,  90931L,  90947L,  90971L,  90977L,
            90989L,  90997L,  91009L,  91019L,  91033L,  91079L,  91081L,  91097L,  91099L,  91121L,
            91127L,  91129L,  91139L,  91141L,  91151L,  91153L,  91159L,  91163L,  91183L,  91193L,
            91199L,  91229L,  91237L,  91243L,  91249L,  91253L,  91283L,  91291L,  91297L,  91303L,
            91309L,  91331L,  91367L,  91369L,  91373L,  91381L,  91387L,  91393L,  91397L,  91411L,
            91423L,  91433L,  91453L,  91457L,  91459L,  91463L,  91493L,  91499L,  91513L,  91529L,
            91541L,  91571L,  91573L,  91577L,  91583L,  91591L,  91621L,  91631L,  91639L,  91673L,
            91691L,  91703L,  91711L,  91733L,  91753L,  91757L,  91771L,  91781L,  91801L,  91807L,
            91811L,  91813L,  91823L,  91837L,  91841L,  91867L,  91873L,  91909L,  91921L,  91939L,
            91943L,  91951L,  91957L,  91961L,  91967L,  91969L,  91997L,  92003L,  92009L,  92033L,
            92041L,  92051L,  92077L,  92083L,  92107L,  92111L,  92119L,  92143L,  92153L,  92173L,
            92177L,  92179L,  92189L,  92203L,  92219L,  92221L,  92227L,  92233L,  92237L,  92243L,
            92251L,  92269L,  92297L,  92311L,  92317L,  92333L,  92347L,  92353L,  92357L,  92363L,
            92369L,  92377L,  92381L,  92383L,  92387L,  92399L,  92401L,  92413L,  92419L,  92431L,
            92459L,  92461L,  92467L,  92479L,  92489L,  92503L,  92507L,  92551L,  92557L,  92567L,
            92569L,  92581L,  92593L,  92623L,  92627L,  92639L,  92641L,  92647L,  92657L,  92669L,
            92671L,  92681L,  92683L,  92693L,  92699L,  92707L,  92717L,  92723L,  92737L,  92753L,
            92761L,  92767L,  92779L,  92789L,  92791L,  92801L,  92809L,  92821L,  92831L,  92849L,
            92857L,  92861L,  92863L,  92867L,  92893L,  92899L,  92921L,  92927L,  92941L,  92951L,
            92957L,  92959L,  92987L,  92993L,  93001L,  93047L,  93053L,  93059L,  93077L,  93083L,
            93089L,  93097L,  93103L,  93113L,  93131L,  93133L,  93139L,  93151L,  93169L,  93179L,
            93187L,  93199L,  93229L,  93239L,  93241L,  93251L,  93253L,  93257L,  93263L,  93281L,
            93283L,  93287L,  93307L,  93319L,  93323L,  93329L,  93337L,  93371L,  93377L,  93383L,
            93407L,  93419L,  93427L,  93463L,  93479L,  93481L,  93487L,  93491L,  93493L,  93497L,
            93503L,  93523L,  93529L,  93553L,  93557L,  93559L,  93563L,  93581L,  93601L,  93607L,
            93629L,  93637L,  93683L,  93701L,  93703L,  93719L,  93739L,  93761L,  93763L,  93787L,
            93809L,  93811L,  93827L,  93851L,  93871L,  93887L,  93889L,  93893L,  93901L,  93911L,
            93913L,  93923L,  93937L,  93941L,  93949L,  93967L,  93971L,  93979L,  93983L,  93997L,
            94007L,  94009L,  94033L,  94049L,  94057L,  94063L,  94079L,  94099L,  94109L,  94111L,
            94117L,  94121L,  94151L,  94153L,  94169L,  94201L,  94207L,  94219L,  94229L,  94253L,
            94261L,  94273L,  94291L,  94307L,  94309L,  94321L,  94327L,  94331L,  94343L,  94349L,
            94351L,  94379L,  94397L,  94399L,  94421L,  94427L,  94433L,  94439L,  94441L,  94447L,
            94463L,  94477L,  94483L,  94513L,  94529L,  94531L,  94541L,  94543L,  94547L,  94559L,
            94561L,  94573L,  94583L,  94597L,  94603L,  94613L,  94621L,  94649L,  94651L,  94687L,
            94693L,  94709L,  94723L,  94727L,  94747L,  94771L,  94777L,  94781L,  94789L,  94793L,
            94811L,  94819L,  94823L,  94837L,  94841L,  94847L,  94849L,  94873L,  94889L,  94903L,
            94907L,  94933L,  94949L,  94951L,  94961L,  94993L,  94999L,  95003L,  95009L,  95021L,
            95027L,  95063L,  95071L,  95083L,  95087L,  95089L,  95093L,  95101L,  95107L,  95111L,
            95131L,  95143L,  95153L,  95177L,  95189L,  95191L,  95203L,  95213L,  95219L,  95231L,
            95233L,  95239L,  95257L,  95261L,  95267L,  95273L,  95279L,  95287L,  95311L,  95317L,
            95327L,  95339L,  95369L,  95383L,  95393L,  95401L,  95413L,  95419L,  95429L,  95441L,
            95443L,  95461L,  95467L,  95471L,  95479L,  95483L,  95507L,  95527L,  95531L,  95539L,
            95549L,  95561L,  95569L,  95581L,  95597L,  95603L,  95617L,  95621L,  95629L,  95633L,
            95651L,  95701L,  95707L,  95713L,  95717L,  95723L,  95731L,  95737L,  95747L,  95773L,
            95783L,  95789L,  95791L,  95801L,  95803L,  95813L,  95819L,  95857L,  95869L,  95873L,
            95881L,  95891L,  95911L,  95917L,  95923L,  95929L,  95947L,  95957L,  95959L,  95971L,
            95987L,  95989L,  96001L,  96013L,  96017L,  96043L,  96053L,  96059L,  96079L,  96097L,
            96137L,  96149L,  96157L,  96167L,  96179L,  96181L,  96199L,  96211L,  96221L,  96223L,
            96233L,  96259L,  96263L,  96269L,  96281L,  96289L,  96293L,  96323L,  96329L,  96331L,
            96337L,  96353L,  96377L,  96401L,  96419L,  96431L,  96443L,  96451L,  96457L,  96461L,
            96469L,  96479L,  96487L,  96493L,  96497L,  96517L,  96527L,  96553L,  96557L,  96581L,
            96587L,  96589L,  96601L,  96643L,  96661L,  96667L,  96671L,  96697L,  96703L,  96731L,
            96737L,  96739L,  96749L,  96757L,  96763L,  96769L,  96779L,  96787L,  96797L,  96799L,
            96821L,  96823L,  96827L,  96847L,  96851L,  96857L,  96893L,  96907L,  96911L,  96931L,
            96953L,  96959L,  96973L,  96979L,  96989L,  96997L,  97001L,  97003L,  97007L,  97021L,
            97039L,  97073L,  97081L,  97103L,  97117L,  97127L,  97151L,  97157L,  97159L,  97169L,
            97171L,  97177L,  97187L,  97213L,  97231L,  97241L,  97259L,  97283L,  97301L,  97303L,
            97327L,  97367L,  97369L,  97373L,  97379L,  97381L,  97387L,  97397L,  97423L,  97429L,
            97441L,  97453L,  97459L,  97463L,  97499L,  97501L,  97511L,  97523L,  97547L,  97549L,
            97553L,  97561L,  97571L,  97577L,  97579L,  97583L,  97607L,  97609L,  97613L,  97649L,
            97651L,  97673L,  97687L,  97711L,  97729L,  97771L,  97777L,  97787L,  97789L,  97813L,
            97829L,  97841L,  97843L,  97847L,  97849L,  97859L,  97861L,  97871L,  97879L,  97883L,
            97919L,  97927L,  97931L,  97943L,  97961L,  97967L,  97973L,  97987L,  98009L,  98011L,
            98017L,  98041L,  98047L,  98057L,  98081L,  98101L,  98123L,  98129L,  98143L,  98179L,
            98207L,  98213L,  98221L,  98227L,  98251L,  98257L,  98269L,  98297L,  98299L,  98317L,
            98321L,  98323L,  98327L,  98347L,  98369L,  98377L,  98387L,  98389L,  98407L,  98411L,
            98419L,  98429L,  98443L,  98453L,  98459L,  98467L,  98473L,  98479L,  98491L,  98507L,
            98519L,  98533L,  98543L,  98561L,  98563L,  98573L,  98597L,  98621L,  98627L,  98639L,
            98641L,  98663L,  98669L,  98689L,  98711L,  98713L,  98717L,  98729L,  98731L,  98737L,
            98773L,  98779L,  98801L,  98807L,  98809L,  98837L,  98849L,  98867L,  98869L,  98873L,
            98887L,  98893L,  98897L,  98899L,  98909L,  98911L,  98927L,  98929L,  98939L,  98947L,
            98953L,  98963L,  98981L,  98993L,  98999L,  99013L,  99017L,  99023L,  99041L,  99053L,
            99079L,  99083L,  99089L,  99103L,  99109L,  99119L,  99131L,  99133L,  99137L,  99139L,
            99149L,  99173L,  99181L,  99191L,  99223L,  99233L,  99241L,  99251L,  99257L,  99259L,
            99277L,  99289L,  99317L,  99347L,  99349L,  99367L,  99371L,  99377L,  99391L,  99397L,
            99401L,  99409L,  99431L,  99439L,  99469L,  99487L,  99497L,  99523L,  99527L,  99529L,
            99551L,  99559L,  99563L,  99571L,  99577L,  99581L,  99607L,  99611L,  99623L,  99643L,
            99661L,  99667L,  99679L,  99689L,  99707L,  99709L,  99713L,  99719L,  99721L,  99733L,
            99761L,  99767L,  99787L,  99793L,  99809L,  99817L,  99823L,  99829L,  99833L,  99839L,
            99859L,  99871L,  99877L,  99881L,  99901L,  99907L,  99923L,  99929L,  99961L,  99971L,
            99989L,  99991L
    );

    @Test
    public void testSmallPrimes() {
        long limit = SMALL_PRIMES.get(SMALL_PRIMES.size() - 1);
        PrimeGenerator generator = getPrimeGenerator();
        List<Long> primes = generator.findAll(limit);

        Assert.assertEquals(SMALL_PRIMES, primes);
    }

    @Test
    public void testPrimesInRange() {
        PrimeGenerator generator = getPrimeGenerator();
        List<Long> primesInRange = generator.findAll(RANGE_START, RANGE_END);

        Assert.assertEquals(PRIMES_IN_RANGE, primesInRange);
    }

    @Test
    public void testEach10LthPrime() {
        int limit = 10_000_000;
        PrimeGenerator generator = getPrimeGenerator();
        List<Long> list = generator.findAll(limit);

        for (int i = 0; i < list.size(); i += 10) {
            Assert.assertTrue("number must be prime", isPrime(list.get(i)));
        }
    }

    /**
     * Tests whether the given number is prime using trial division method.
     * @param n number to test
     * @return true if the number is prime
     */
    static boolean isPrime(long n) {
        long sqrt = (long)Math.sqrt((double)n);
        int idx = Collections.binarySearch(SMALL_PRIMES, sqrt);
        return !IntStream.range(0, idx > 0 ? idx + 1 : (-idx - 1))
                .mapToLong(SMALL_PRIMES::get)
                .anyMatch(p -> n % p == 0L);
    }

    protected abstract PrimeGenerator getPrimeGenerator();
}
